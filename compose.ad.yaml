services:
  payment-service:
    build: ./compose/billing/payment
    networks:
      - movies-network
    command: [ '/opt/app/commands/fastapi.sh', 'dev' ]
    healthcheck:
      test: [ 'CMD-SHELL', 'curl -s http://localhost:8000/payment/api/_health' ]
      interval: 10s
      timeout: 10s
      retries: 5
      start_period: 10s
    ports:
      - '8000:8000'
    environment:
      - YOOMONEY_CLIENT_ID=$YOOMONEY_CLIENT_ID
      - YOOMONEY_REDIRECT_URI=$YOOMONEY_REDIRECT_URI
      - YOOMONEY_SECRET=$YOOMONEY_SECRET
      - YOOMONEY_RECEIVER_ACCOUNT=$YOOMONEY_RECEIVER_ACCOUNT
    develop:
      watch:
        - action: sync
          path: ./compose/billing/payment/src
          target: /opt/app/src
        - action: rebuild
          path: ./compose/billing/payment/commands
        - action: rebuild
          path: ./compose/billing/payment/pyproject.toml
        - action: rebuild
          path: ./compose/billing/payment/poetry.lock

networks:
  movies-network:

volumes:
  payment-redis-data: